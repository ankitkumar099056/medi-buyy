var MB_Analytics=function(){function e(){function e(){!function(e,t,a,i,n,o,s,r){if(!e[i]||!e[i]._q){for(;r<s.length;)n(o,s[r++]);var l=t.createElement(a);l.async=!0,l.src="https://cdn.branch.io/branch-latest.min.js";var c=t.getElementsByTagName(a)[0];c.parentNode.insertBefore(l,c),e[i]=o}}(window,document,"script","branch",function(e,t){e[t]=function(){e._q.push([t,arguments])}},{_q:[],_v:1},["addListener","applyCode","autoAppIndex","banner","closeBanner","closeJourney","creditHistory","credits","data","deepview","deepviewCta","first","getCode","init","link","logout","redeem","referrals","removeListener","sendSMS","setBranchViewData","setIdentity","track","validateCode","trackCommerceEvent","logEvent","disableTracking","getBrowserFingerprintId","crossPlatformIds","lastAttributedTouchData"],0)}var t=!0,a=!0,i=!0,n=!0,o=!0,s=!0,r=!0,l=!!window.isProduction,c=0,u=["page","eventCategory","eventAction","eventLabel","title"],d=function(e,t,a,i){var n={methodName:e,requestBody:JSON.stringify(t),responseBody:a,exceptionMessage:i};fetch("https://www.medibuddy.in/WAPI/Log",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})},p=function(){return new Promise(function(e,t){var a=setInterval(function(){window.snowplow&&(clearInterval(a),clearTimeout(i),console.log("Snowplow is initialised!"),e())},50),i=setTimeout(function(){clearInterval(a),t(new Error("Snowplow initialization timed out!"))},5e3)})},m=function(t){return new Promise(function(t,a){p().then(function(){e(),branch||a(new Error("branch not initialised")),branch.init("key_live_ioIMsMxyT1Hw5LABZ6mYRnmlrug2AbW5",function(e,i){!e&&i||a(new Error("Branch not initialised!")),branch.getBrowserFingerprintId(function(e,i){e&&a(new Error("Fingerprint error"));var n={schema:"iglu:com.medibuddy/BROWSER_CONTEXT/jsonschema/1-0-0",data:{branchBrowserFingerprint:i}};window.snowplow("addGlobalContexts",[n]),t()})})})})};return{cleverTap:t,gtmAnalyticsPlatform:a,googleAnalytics:i,branch:n,dbLog:s,hotjar:r,facebookPixel:o,branchContext:c,__trackUser:function(e){if(l){if(this.cleverTap)try{clevertap.onUserLogin.push(window._Site_Props.__getUserObj({clevertap:!0}))}catch(t){console.log(t)}this.branch&&e&&window._Site_Props.__getUserObj()&&window._Site_Props.__getUserObj().uuid&&branch.setIdentity(window._Site_Props.__getUserObj().uuid+"",function(e,t){console.log(e?e:t)})}else console.log(window._Site_Props.__getUserObj({clevertap:!0}))},__setSnowPlowUserId:function(e){"undefined"!=typeof window&&window.snowplow&&window.snowplow("setUserId",e)},__push:function(e){try{if(e){_.isObject(e.payload)||(e.payload={});var t=window.localStorage.getItem("UniqSessionId");if(!t){var a=(new Date).getTime(),i="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;t="xxxxxxxx-xxxx-Lxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random();return a>0?(t=(a+t)%16|0,a=Math.floor(a/16)):(t=(i+t)%16|0,i=Math.floor(i/16)),("x"===e?t:3&t|8).toString(16)}),window.localStorage.setItem("UniqSessionId",t)}e.payload.sessionId=t}}catch(n){console.log("error settion sessionId")}if(l){if(this.cleverTap&&e.isCleverTap||"true"==e.excludeCleverTap){var o={srcType:window.getSrcType(),utm_source:e.payload&&e.payload.utm_source||window.sessionStorage.getItem("utm_source")||"medibuddyInWeb",utm_medium:e.payload&&e.payload.utm_medium||window.sessionStorage.getItem("utm_medium")||"",utm_campaign:e.payload&&e.payload.utm_campaign||window.sessionStorage.getItem("utm_campaign")||"",userType:"retail",userId:""};window.loggedInEmail&&(o.email=window.loggedInEmail),window.IP&&(o.userIP=window.IP),window.sessionStorage.getItem("utm_medium")&&(o.utm_medium=window.sessionStorage.getItem("utm_medium"));var s=window._Site_Props.__getUserObj();_.isEmpty(s)||(o.userId=s.userDetails?s.userDetails.userId:"",o.mbuuid=s.userDetails?s.userDetails.uuid:"",o.pmEntityID=s.userDetails?s.userDetails.pmEntityID:"",o.userType=s.isRetailUser?"retail":"corporate",o.email=s.userDetails&&s.userDetails.email?s.userDetails.email:"",o.mobile=s.userDetails&&s.userDetails.phone?s.userDetails.phone:"","labs"!=e.dbLog||s.isRetailUser||(o.CompanyName=s.corpDetails&&s.corpDetails.employeeDetail?s.corpDetails.employeeDetail.companyName||"":""),s.isRetailUser||(o.CompanyName=s.corpDetails&&s.corpDetails.employeeDetail?s.corpDetails.employeeDetail.companyName||"":"","true"==window.sessionStorage.getItem("isOneClickFlow")&&(o.isOneClickFlow=window.sessionStorage.getItem("isOneClickFlow")))),window.localStorage.getItem("parent_app")&&(o.parentSourceUrl=window.localStorage.getItem("parent_app")),window.sessionStorage.getItem("LatLong")&&(o.LatLong=window.sessionStorage.getItem("LatLong"));var r=_.extend(o,_.omit(e.payload,u,"isViewOrEvent"));r&&!r.location&&(r.city=window._Site_Props.location),r&&"labs"==e.dbLog&&window._Site_Props.pincode&&(r.pincode=window._Site_Props.pincode),clevertap&&"function"==typeof clevertap.getCleverTapID&&(r["CT-ID"]=clevertap.getCleverTapID());try{e.dbLog&&r&&e.name&&this.dbLog&&this.__eventLogToDB(e.dbLog,e.name,r)}catch(c){console.log(e.name,r,"EventLog")}try{if(clevertap&&"true"!=e.excludeCleverTap&&clevertap.event.push(e.name,r),e.googleSheet&&r&&e.name){var d="string"==typeof e.googleSheet?e.googleSheet:r.serviceName;d&&this.__googleSheetPush(d,e.name,r)}if(("labs"==e.dbLog||e.hj)&&e.name&&this.hotjar){var p="";e.name.split(" ").length>1?p=e.name.toLowerCase().replace(/\ /g,"_"):(p=e.name.charAt(0).toLowerCase()+e.name.substring(1),p=p.replace(/([A-Z])/g,"_$1")),window.hj("event",p)}}catch(n){console.log(e.name,r)}}if(this.googleAnalytics&&(e.isGoogle&&e.payload&&ga("send",_.extend(_.pick(e.payload,u),{hitType:e.payload.isViewOrEvent})),e.gtag&&(gtag("event","purchase",e.payload),dataLayer.push({event:"paymentSuccess",conversionValue:e.payload.value,serviceType:e.payload.u2}),console.log("gtag -> ","purchase",e.payload))),this.facebookPixel&&e.fbq&&e.payload){var h={content_category:e.payload.serviceName,content_type:e.payload.packageName||e.payload.serviceType||e.payload.u2};(e.payload.amount||e.payload.value)&&(h.value=e.payload.amount||e.payload.value,h.currency="INR");try{e.fbqReference&&fbq("track",e.fbqReference,h)}catch(n){console.log(n)}}if(this.branch&&e.branchLog){var g=e.branchLog,w={source:window.location.search.split("utm_source=")[1]};window._Site_Props.__getUserObj().userDetails&&(w.mbUserId=window._Site_Props.__getUserObj().userDetails.userId);var f=[]||e.content_items;_.extend(w,g.custom_data),w.source||delete w.source;var y=g.alias||"";try{branch.logEvent(g.name||e.name,w,f,y,function(e){e&&console.log(e)})}catch(n){console.log(g.name||e.name,w)}}this.gtmAnalyticsPlatform&&e&&e.name&&e.schema&&e.payload&&(0==this.branchContext?m().then(function(){window.dataLayer.push({event:e.name,schema:e.schema,payload:e.payload,ctx:"INFINITY_WEB"})})["catch"](function(e){console.log("error in adding snowplow global context")})["finally"](function(){this.branchContext=1}.bind(this)):window.dataLayer.push({event:e.name,schema:e.schema,payload:e.payload,ctx:"INFINITY_WEB"}))}else e.name&&console.log(e.name,_.omit(e.payload,u,"isViewOrEvent")),e.branchLog&&console.log("branch -> ",e.branchLog.name||e.name,e.branchLog.custom_data)},__resetOnLogout:function(){if(l){if(this.cleverTap){try{clevertap.logout()}catch(e){}delete window.loggedInEmail}this.branch&&branch.logout&&branch.logout()}},__confirmPushNotification:function(){if(l&&this.cleverTap)try{clevertap.notifications.push({titleText:"Hey, we would like to stay in touch with you!",bodyText:"We promise to only send you relevant content and give you updates on your transactions",okButtonText:"Sure!",rejectButtonText:"Not Now",okButtonColor:"#458bc7",rejectButtonColor:"#458bc7",askAgainTimeInSeconds:86400,serviceWorkerPath:"/clevertap_sw.js",hidePoweredByCT:!0})}catch(e){}},__googleSheetPush:function(e,t,a){return void this.__leadsPush(t,a)},__leadsPush:function(e,t){var a=window._Site_Props.__getUserObj(),i={patientId:a.userDetails.userId+"",pmentityid:a.userDetails.pmEntityID+"",mbuserid:a.userDetails.userId+"",mbuuid:a.userDetails.mbuuid+"",phoneNumber:a.userDetails.phone?a.userDetails.phone+"":"",type:"AHC - "+e,source:"Labs",meta:JSON.stringify(t),platform:window.getSrcType(),channel:"Browser"};fetch("https://claratech.medibuddy.in/sales/addLeads/",{method:"post",headers:{"Content-Type":"text/plain"},body:JSON.stringify({records:[i]})})},__eventLogToDB:function(e,t,a){var i="";switch(e){case"labs":i="mblabs";break;case"hc":i="mbinfiniti";break;case"ucp":i="mbcorp";break;case"ahc":i="mbAHC";break;case"meds":i="mbMeds";break;case"mc":i="mediclinic";break;case"consumerlabs":i="mbConsumerLabs";break;default:i="medibuddy"}if(i&&a){var n={user:a.userId,mbuserid:a.userId?a.userId:"",patientid:a.patientid?a.patientid:"",pmentityid:a.pmEntityID?a.pmEntityID:"",mbuuid:a.mbuuid?a.mbuuid:"",platform:window.getSrcType(),info:a.loginScreenEvent?a.loginScreenEvent:t,domain:i,event:t,appversion:a.srcType,serviceName:a.serviceName,meta:JSON.stringify(a),sessionId:a.sessionId,EventData:a};a.consultationId&&"mblabs"==i&&(n.consultationId=a.consultationId),fetch("https://eventlogs.docsapp.in/event",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(e){e.ok||"MB Home Page"!=t&&"Page View"!=t&&d("EventLogFailure",n,t,"")})["catch"](function(e){"MB Home Page"!=t&&"Page View"!=t&&d("EventLogFailure",_.extend(n,{isException:!0}),t,"Exception")})}}}}var t;return{getInstance:function(){return t||(t=e()),t}}}(),Site_Properties=function(){function e(){return{eventParameters:{},userObj:{},serviceDetails:{},packageDetails:{},filterDetails:{},purchaseDetail:{},labsCartInfo:{},location:"",pincode:"",sortBy:"",__getEventParameters:function(e){this.eventParameters={};var t="";if(e.service)for(t in this.serviceDetails)this.eventParameters[t]=this.serviceDetails[t];if(e["package"])for(t in this.packageDetails)this.eventParameters[t]=this.packageDetails[t];if(e.filter)for(t in this.filterDetails)this.eventParameters[t]=this.filterDetails[t];if(e.sortBy&&(this.eventParameters.sortBy=this.sortBy),e.custom)for(t in e.custom)this.eventParameters[t]=e.custom[t];if(e.google)for(t in e.google)this.eventParameters[t]=e.google[t];if(e.purchase)for(t in this.purchaseDetail)this.eventParameters[t]=this.purchaseDetail[t];if(e.labsCart)for(t in this.labsCartInfo)this.eventParameters[t]=this.labsCartInfo[t];return this.eventParameters.location=this.location,this.eventParameters},__setUserObj:function(e){this.userObj=e},__getUserObj:function(e){if(!this.userObj)return{};if(e&&e.clevertap){var t={Site:{Name:this.userObj.userDetails.displayName,Identity:this.userObj.userDetails.userId,Email:this.userObj.userDetails.email,EntityId:this.userObj.pmEntityID,Phone:this.userObj.userDetails.phone?"+91"+this.userObj.userDetails.phone:"",Gender:this.userObj.userDetails.gender,LocationSelected:this.location,Dependants:[],EmailId:this.userObj.userDetails.email,ReferralCode:this.userObj.userDetails.referDetails&&this.userObj.userDetails.referDetails.referCode?this.userObj.userDetails.referDetails.referCode:"",DOB:new Date(parseInt(this.userObj.userDetails.dateOfBirth.replace("/Date(",""))),DateOfBirth:this.userObj.userDetails.dateOfBirth}};return this.userObj.corpDetails&&this.userObj.corpDetails.employeeDetail&&(_.forEach(this.userObj.corpDetails.employeeDetail.iwpBeneficiaries,function(e){1!==e.relationId&&t.Site.Dependants.push({name:e.name,relation:e.relationName,gender:e.gender})}),this.userObj.corpDetails.employeeDetail.companyName&&(t.Site.CompanyName=this.userObj.corpDetails.employeeDetail.companyName)),this.userObj.userDetails.altEmail&&(t.Site.AlternateEmailId=this.userObj.userDetails.altEmail),t}return this.userObj},__setPackageDetails:function(e){this.packageDetails=e},__getPackageDetails:function(){return this.packageDetails},__setServiceDetails:function(e){this.serviceDetails=e},__getServiceDetails:function(){return this.serviceDetails},__setPurchaseDetails:function(e,t,a){this.purchaseDetail={allow_custom_scripts:!0,value:t,transaction_id:e,u2:a,send_to:"DC-9375497/sales/medi_0+transactions",currency:"INR",u3:window._Site_Props.__getUserObj().corpDetails?1:0}},__setFilterDetails:function(e){this.filterDetails=e},__getFilterDetails:function(){return this.filterDetails},__setLocation:function(e,t){this.location=e,t&&(this.pincode=t)},__setSortBy:function(e){this.sortBy=e},__googleTransform:function(e,t,a){return{isViewOrEvent:a?"event":"pageview",page:window.location.pathname,eventCategory:a&&e?e.toLowerCase():"",eventAction:t||"",eventLabel:a||"",title:a?e+" "+t:e}},__setLabsCartInfo:function(e){var t=[];e.labs.length&&t.push("labTest"),e.packages.length&&t.push("hcPackage"),this.labsCartInfo={serviceType:_.union(_.pluck(e.labs,"packageName"),_.pluck(e.packages,"packageName")).toString(),labTestCount:e.labs.length,healthCheckCount:e.packages.length,productType:t.toString(),serviceName:"labTest"}},__getLabsCartInfo:function(){return this.labsCartInfo}}}var t;return{getInstance:function(){return t||(t=e()),t}}}();window._MB_Analytics=new MB_Analytics.getInstance,window._Site_Props=new Site_Properties.getInstance;