!function(){"use strict";define(["_routes","utility"],function(e,a){e.register.controller("labTestsListingController",["$scope","authService","apiProvider","$window","$rootScope","$timeout","$uibModal","$state","navConstantsSvc","standardEventsSvc","$stateParams","$sce","$location","localStorageService","corpLabsService","$interval",function(e,t,r,s,i,o,c,n,l,d,g,p,u,m,P,h){function v(){e.mergeList=P.labsCart(),e.cartPipeline={},e.cardPipeline={},e.famPipeline={},e.searchPipeline={},L(),e.dialog=P.dialog,e.dialog.comparePackages=e.dialog.comparePackages&&(!y||y&&y.userDetails&&l.smartpackages.includes(y.userDetails.pmEntityID)),e.radiologyPage=!1,e.currentState=n.current.name,e.sectionList=["categories","labTests"],e.cardPipeline.reqBody={contractIds:[l.labtestContract],loadCategories:!0,category:"Default"},e.cardPipeline.srcImg="/assets/icons/corpLabs/health-checkup.svg",e.cardPipeline.selCategory=g.catg||"","/radiologyTests"==u.path()?(e.sectionList=["categories","labTests","packages"],e.radiologyPage=!0,e.cardPipeline.reqBody.contractIds.push(l.healthCheckContract),e.cardPipeline.reqBody.loadOnlyRadiology=!0,g.catg?(e.cardPipeline.srcImg="/assets/icons/corpLabs/categories/radiology/"+g.catg.toLowerCase().replace(" ","-")+".svg",e.cardPipeline.title=g.catg):(P.sendEvents("Labs Radiology Landing Page"),P.sendEventsV1(d.LABS_RADIOLOGY_SCREEN_LANDING))):(e.cardPipeline.labTestPage=!0,g.catg?(e.cardPipeline.srcImg="/assets/icons/corpLabs/categories/labtest/"+g.catg.toLowerCase().replace(" ","-")+".svg",e.cardPipeline.title=g.catg):(P.sendEvents("Labs LabTests Landing Page"),P.sendEventsV1(d.LABS_BOOK_TEST_SCREEN_LANDING))),e.hideLabsHeader=!!e.cardPipeline.selCategory,e.hideLabsHeader&&(_.isEmpty(y)?P.getCartLS():P.getCartDetails()),o(function(){a.hideFooter(!0)})}function L(){e.bookRadiology=[{label:"Select your Required Scans / Xray / MRI",srcImg:"/assets/icons/corpLabs/categories/radiology/book-radiology-1.1.svg"},{label:"Select your Nearest Labcentre and time slot",srcImg:"/assets/icons/corpLabs/categories/radiology/book-radiology-1.2.svg"},{label:"Visit Lab centre and get you test done.",srcImg:"/assets/icons/corpLabs/categories/radiology/book-radiology-1.3.svg"},{label:"Reports will be Uploaded or mailed",srcImg:"/assets/icons/corpLabs/categories/radiology/book-radiology-1.4.svg"}]}function b(){n.go("app.consumerCart")}function f(a,t,r,s){e.famPipeline={selectedItems:a||[],refreshCart:t,transit:r,show:!0,mergeList:e.mergeList,"package":s&&_.isArray(a)&&1==a.length?a[0]:"",searchPackages:_.isArray(a)&&a.length>1?a:""}}function C(e){var a="";switch(e){case"hc-packages":a="Health Checks";break;case"labTests":a="Lab Tests";break;case"search":a="Search Results";break;case"covid-search":a="Search Popular Covid Tests";break;case"tests-search":a="Search Popular Lab Tests";break;case"packages-search":a="Search Popular Health Checks";break;case"compare-package-popup":a="Compare Package Popup"}return a}s.scrollTo(0,0),window.updateSrc=!0;var y=t.isUserSignedin(),k=!1;v(),s.onclick=function(t){if(!e.hideLabsHeader){var r=document.querySelector("#search-input");if(!e.dialog.searchPopover)return e.dialog.searchPopover=r&&r.contains(t.target),e.dialog.searchPopover&&(P.sendEvents("Search Page"),e.isMobileView&&o(function(){a.hideFooter(!0)})),void e.$apply();if(!e.isMobileView){var s=document.querySelector("#search-popover");s&&!s.contains(t.target)&&r&&!r.contains(t.target)&&(e.dialog.searchPopover=!1,e.$apply())}}},e.handleBack=function(){e.dialog.searchPopover&&e.isMobileView?e.dialog.searchPopover=!1:g.catg?n.go(n.current,{catg:""},{reload:!0}):n.go("app.consumerLabs")},e.searchPipeline.addToCart=function(){k=!0,P.sendEvents("Search Proceed Button Clicked",{},e.mergeList.searchCart),e.cardPipeline.showBenefPopup?f(e.mergeList.searchCart,!0,!0,!0):P.addItemsToCart(e.mergeList.searchCart,"+",!0,!!y),e.dialog.searchPopover=!1},e.cardPipeline.addItem=function(a,t,r,s){var i=C(r);return a.source=i,P.sendEvents("Add To Cart Button Clicked",{CartSource:i},new Array(a)),s&&s.stopPropagation(),t?void(e.cardPipeline.showBenefPopup?f(new Array(a),!1,!1,!0):P.addItemsToCart(new Array(a),"+",!1,!!y)):void(a.patientId=e.mergeList.defaultPatId)},e.cardPipeline.removeItem=function(e,a,t,r){var s=C(t);P.sendEvents("Remove From Cart Button Clicked",{CartSource:s},new Array(e)),r&&r.stopPropagation(),a&&P.addItemsToCart(new Array(e),"-",!1,!!y)};var S=i.$on("userLogin",function(a,r){return y=t.isUserSignedin(),y&&y.userDetails&&!y.isMergeFlowEnabled?void u.url("/"):(P.removeCartLS(),void P.addItemsToCart(e.mergeList.selectedList[0],"+",!1,!0,{blockEvents:!0}))}),I=i.$on("userLogout",function(a,t){y=null,e.benefArray=[],P.saveUniqCart()}),w=i.$on("userLocation",function(e,a){_.isEmpty(y)?P.getCartLS():P.getCartDetails()}),E=i.$on("cartItemsUpdated",function(a,t){e.mergeList=P.labsCart(),e.cartPipeline.testsCnt=e.mergeList.tests.length,e.cartPipeline.packagesCnt=e.mergeList.packages.length,e.cartPipeline.totalPrice=e.mergeList.totalPrice,e.cartPipeline.isLabVisit=e.mergeList.isLabVisit,e.cartPipeline.isLabVisit&&(e.cartPipeline.cvPackages=[],_.each(_.union(e.mergeList.tests,e.mergeList.packages),function(a){!a.isHomeSampleCollection&&e.cartPipeline.cvPackages.push(a.packageDisplayName)}),e.cartPipeline.cvPackages=_.uniq(e.cartPipeline.cvPackages)),e.cardPipeline.showBenefPopup=e.mergeList.patients.length>1,k&&(k=!1,b())}),T=e.$on("familyConfirmClicked",function(a,t,r){var s=[];if(_.each(t,function(a){e.famPipeline.selectedItems.forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.patientId=a.maid,t.relation=a.relationName,s.push(t)})}),e.famPipeline.refreshCart){var i=t.map(function(e){return e.maid});_.each(_.union(e.mergeList.tests,e.mergeList.packages),function(e){i.includes(e.patientId)||s.push(e)})}P.addItemsToCart(s,"+",e.famPipeline.refreshCart,!0),e.famPipeline={show:!1,selectedItems:[],transit:!1,refreshCart:!1}});e.$on("$destroy",function(e){w(),E(),T(),S(),I(),P.searchPopover=!1,window.updateSrc=!1,a.hideFooter(!1)})}])})}();