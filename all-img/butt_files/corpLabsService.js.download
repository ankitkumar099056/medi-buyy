!function(){"use strict";define(["angular","utility"],function(e,t){var a=e.module("marketplace.CorpLabsService",[]);a.factory("corpLabsService",["navConstantsSvc","standardEventsSvc","apiProvider","$sce","authService","$rootScope","$http","$window","$uibModal","notify","$state","localStorageService","$timeout","$cookies",function(e,a,i,s,n,r,o,c,l,d,p,u,m,f){function g(){var e="medibuddy";return p.includes("app.home")?e="Medibuddy Home Page":p.includes("app.consumerLabsCheckout")?e="ConsumerLabs Checkout Page":p.includes("app.consumerLabs")?e="ConsumerLabs Landing Page":p.includes("app.radiologyTests")?e="ConsumerLabs Radiology Page":p.includes("app.labTestsListing")?e="ConsumerLabs LabTests Page":p.includes("app.consumercorplabs")?e="ConsumerLabs Corporate Page":p.includes("app.consumerCart")?e="ConsumerLabs Cart":p.includes("app.consumerPackages")?e="ConsumerLabs Packages Page":p.includes("app.consumerTests")?e="ConsumerLabs Test Detail":p.includes("app.trackOrder")?e="ConsumerLabs Track Order":p.includes("app.patientListing")?e="ConsumerLabs Order Listing":p.includes("app.providerTests")?e="ConsumerLabs Provider Serving tests":p.includes("app.providerlisting")?e="ConsumerLabs Providers Listing":p.includes("app.consumerLabsProviderDetails")&&(e="ConsumerLabs Provider Info"),e}function h(e){return e*(Math.PI/180)}function I(e,t){const a={};if(_.isEmpty(e))return{};try{a.package_id=_.pluck(e,"packageId").join(),a.package_name=_.pluck(e,"packageDisplayName").join(),a.patientid=_.uniq(_.pluck(e,"patientId")).filter(function(e){return!!e}),a.isHybridPackagePresent=e.some(function(e){return e.packageSplit&&e.packageSplit.isHybrid}),a.visitType=N&&N.cartVisitType?N.cartVisitType.toLowerCase():"",a.patient_relation=[],a.patient_name=[],a.patient_age=[],_.isEmpty(a.patientid)||_.isEmpty(t)||_.isEmpty(t.corpDetails)||_.isEmpty(t.corpDetails.employeeDetail.beneficiaries)||a.patientid.forEach(function(e){if(e){const i=t.corpDetails.employeeDetail.beneficiaries.find(function(t){return t.maid==e});i&&(a.patient_relation.push(i.relationName),a.patient_name.push(i.name),a.patient_age.push(i.age))}}),a.patientid=a.patientid.join(),a.patient_relation=a.patient_relation.join(),a.patient_name=a.patient_name.join(),a.patient_age=a.patient_age.join()}catch(i){return{}}return a}function v(t){var a=_.isEmpty(N)?[]:_.union(N.tests,N.packages);_.isEmpty(t)&&(t=_.isEmpty(N)?[]:a);var i="labTest";return t.find(function(t){return t.contractId==e.ahcContract})?i="AHC":t.find(function(t){return t.contractId==e.healthCheckContract})&&(i="healthCheck"),{packageName:_.pluck(t,"packageDisplayName").toString(),packageId:_.pluck(t,"packageId").toString(),visitType:t.find(function(e){return!e.isHomeSampleAvailable})?"centerVisit":"homeVisit",contractId:_.uniq(_.pluck(t,"contractId")).toString(),sponsoredPackages:_.filter(a,function(e){return e.isSponsored}).length,ahcTestCount:a.filter(function(t){return t.contractId==e.ahcContract}).length,labTestCount:a.filter(function(t){return t.contractId==e.labtestContract}).length,healthCheckCount:a.filter(function(t){return t.contractId==e.healthCheckContract}).length,dependentCountSelected:_.uniq(_.pluck(a,"patientId")).filter(function(e){return e}).length,paidAhcCount:a.filter(function(t){return t.contractId==e.ahcContract&&t.isPaid}).length,serviceName:i,patientCount:N.patients.length}}function b(e,t){O=n.isUserSignedin();var a={packageIds:e};t&&t.providerId&&(a.providerId=t.providerId),n.makeAjaxCalls(i.apiUrl+"Labs/FetchPackageDetails",a,"POST",O.token,n.getCity(),!0).then(function(e){X(e.data.packages||[],"+",!0)})["catch"](function(e){X([],"+",!0)})}function y(){localStorage.removeItem("labsCartItems")}function C(){var e=n.isUserSignedin();e||N&&localStorage.setItem("labsCartItems",JSON.stringify(_.union(N.tests,N.packages)))}function k(e,t){var a=n.isUserSignedin(),s=null;if(this.providerParams.providerSelected&&(s={providerId:this.providerParams.providerId}),_.isEmpty(e)||(s||(s={}),_.extend(s,e)),a&&a.token){var r="Labs/v1/Cart";!_.isEmpty(t)&&t.getAdditionalTests&&a.isTestsSuggestionEnabled&&(r+="?getAdditionalTests=true"),n.makeAjaxCalls(i.apiUrl+r,"","GET",a.token,n.getCity(),!1,s).then(function(e){N.err=!1,e.data.isSuccess&&X(e.data.cartItems,"+",!0,{},e.data)})["catch"](function(e){N.err=!0})}}function T(){var t=[];_.each(_.union(N.tests,N.packages),function(a){a.contractId==e.ahcContract||t.find(function(e){return e.packageId==a.packageId})||(a.patientId=0,t.push(a))}),X(t,"+",!0)}function S(t){var a="";switch(t.productType||t.contractId){case e.healthCheckContract:a="packages";break;case e.labtestContract:a="tests";break;case e.ahcContract:a="packages"}return a}function L(t){var a=t?t.cartVisitType:"";N.allowedVisitTypes=t?t.allowedVisitTypes:[],N.cartVisitType=a,N.isLabVisit=[e.LabVisitType.LABVISIT,e.LabVisitType.HOMEANDLABVISIT].includes(a),N.isHomeVisit=[e.LabVisitType.HOMEVISIT,e.LabVisitType.HOMEANDLABVISIT].includes(a)}function P(t){t.isLabVisit=[e.LabVisitType.LABVISIT,e.LabVisitType.HOMEANDLABVISIT].includes(t.currentVisitType),t.isHomeVisit=[e.LabVisitType.HOMEVISIT,e.LabVisitType.HOMEANDLABVISIT].includes(t.currentVisitType)}function E(e){var t=n.isUserSignedin();if(!_.isEmpty(t))if(t.isMergeFlowEnabled)p.go(e);else{if(t.isRetailLabsFlowEnabled)return;p.go("app.home")}}function A(t){var a=n.isUserSignedin();if(e.storeAHCConsentStatusForEntities.includes(a.userDetails.pmEntityID)){var s={modifierId:9194,userId:a.userDetails.userId,properties:{IsAgreedToAHCConsent:t}};n.makeAjaxCalls(i.apiUrl+"UpdateUserProperties",s,"POST",a.token).then(function(e){e.data.isSuccess&&(a.userDetails.isAgreedToAHCConsent=t.toString(),u.set("_mp_user",a))})["catch"](function(e){console.log(e)})}}function D(e){return new Promise(function(t,a){var s=n.isUserSignedin();n.makeAjaxCalls(i.apiUrl+"/pageConfiguration?pageId="+e,"","GET",s?s.token:"","",!0,{overridePlatform:c.innerWidth<480?"mweb":"web"}).then(function(e){t(e.data)})["catch"](function(e){a(e)})})}function V(e,t){try{var a=f.get(e);return a?JSON.parse(a):t}catch(i){return t}}function w(e,t,a){try{f.put(e,JSON.stringify(t),a)}catch(i){}}var O=null,N={selectedList:{0:[]},tests:[],packages:[],patients:[],defaultPatId:0,empty:!0,err:!1,totalPrice:0,totalPriceRange:0,searchCart:[],totalSearchCost:0,isLabVisit:!1,isHomeVisit:!1,selectedListVTGrouped:{0:{}},cartVisitType:"",allowedVisitTypes:[]},M={receiver_phone:"NA"},H=function(t,a,o,c){var l={};t&&(Array.isArray(t)?l.packageIds=t:t>0?l.packageIds=[t]:l.deeplinkText=t),a&&(l.providerId=a),o&&(l.patientId=o);var d=!1,p=n.isUserSignedin(),u=new Promise(function(t,a){var o={descriptionMap:{},labCentrePackages:[]},u="Labs/FetchPackageDetails";c&&(u+="?fetchCompareDetails=true",d=!0),n.makeAjaxCalls(i.apiUrl+u,l,"POST",p.token,n.getCity(),d).then(function(i){i.data.isSuccess&&i.data.providerDetail&&(o.providerDetail=i.data.providerDetail),i.data.isSuccess&&!_.isEmpty(i.data.packages)?(_.isEmpty(i.data.packageCompareDetail)||(o.packageCompareDetail=i.data.packageCompareDetail),i.data.packgeCompareText&&(o.packageCompareText=i.data.packgeCompareText),_.each(i.data.packages,function(t){o.descriptionMap[l.deeplinkText?l.deeplinkText:t.packageId]=t,t.selected=t.isPresentInCart,t.maxAge||(t.maxAge=99),t.hideCart=t.contractId==e.ahcContract,t.testsCount=0,t.breakUp=[];var a=t.currentVisitType==e.LabVisitType.HOMEANDLABVISIT?[e.LabVisitType.HOMEVISIT,e.LabVisitType.LABVISIT]:t.currentVisitType==e.LabVisitType.HOMEVISIT?[e.LabVisitType.HOMEVISIT]:[e.LabVisitType.LABVISIT];a.forEach(function(a){var i={visitType:a,testsCount:0},s=[];if(!_.isEmpty(t.availableProfiles)){var n=t.availableProfiles.filter(function(t){return a==e.LabVisitType.HOMEVISIT?t.isHomeSampleAvailable:!t.isHomeSampleAvailable});_.isEmpty(n)||(n.forEach(function(e){i.testsCount+=_.isEmpty(e.availableTests)?0:e.availableTests.length}),s=s.concat(n))}if(!_.isEmpty(t.availableTests)){var o=t.availableTests.filter(function(t){return a==e.LabVisitType.HOMEVISIT?t.isHomeSampleAvailable:!t.isHomeSampleAvailable});_.isEmpty(o)||(i.testsCount+=o.length,s.push({profileName:"Others",availableTests:o}))}if(!_.isEmpty(t.availableConsultations)){var c=t.availableConsultations.filter(function(t){return a==e.LabVisitType.HOMEVISIT?t.isHomeSampleAvailable:!t.isHomeSampleAvailable});_.isEmpty(c)||(i.testsCount+=c.length,s.push({profileName:"Consultations",availableTests:c.map(function(e){return{testId:e.consultationId,testName:e.consultationName,testCode:e.consultationCode}})}))}if(r.isMobileView)i.arrayFirstHalf=s;else{var l=Math.ceil(s.length/2);i.arrayFirstHalf=s.slice(0,l),i.arraySecondHalf=s.slice(l,s.length)}t.breakUp.push(i),t.testsCount+=i.testsCount}),t.tests=[];var i=[];if(_.isEmpty(t.availableProfiles)||(t.tests=t.tests.concat(_.pluck(t.availableProfiles,"availableTests")),i=i.concat(t.availableProfiles)),_.isEmpty(t.availableTests)||(t.tests=t.tests.concat(t.availableTests),i.push({profileName:"Others",availableTests:t.availableTests})),t.tests=_.flatten(t.tests),t.labTestsCount=t.tests.length,t.profilesCount=_.isEmpty(t.availableProfiles)?0:t.availableProfiles.length,t.consultationCount=_.isEmpty(t.availableConsultations)?0:t.availableConsultations.length,_.isEmpty(t.availableConsultations)||(t.tests=t.tests.concat(t.availableConsultations),i.push({profileName:"Consultations",availableTests:t.availableConsultations.map(function(e){return{testId:e.consultationId,testName:e.consultationName,testCode:e.consultationCode}})})),r.isMobileView)t.arrayFirstHalf=i;else{var n=Math.ceil(i.length/2);t.arrayFirstHalf=i.slice(0,n),t.arraySecondHalf=i.slice(n,i.length)}t.tests=_.flatten(t.tests),t.shortDescription&&(t.shortDescription=s.trustAsHtml(t.shortDescription)),t.discount=t.priceRange?Math.floor(100-100*t.price/t.priceRange):0,t.ageText=0==t.minAge&&99==t.maxAge?"All Age Groups":t.minAge+" yrs - "+t.maxAge+" yrs",t.gender&&(t.gender=t.gender.toLowerCase(),"both"==t.gender?(t.genderType="Unisex",t.genderIco="/assets/icons/labs/unisex-ico.svg"):"male"==t.gender||"m"==t.gender?(t.genderType="Male",t.genderIco="/assets/icons/labs/male-ico.svg"):"female"!=t.gender&&"f"!=t.gender||(t.genderType="Female",t.genderIco="/assets/icons/labs/female-ico.svg"))}),t(o)):a()})});return u},x=function(){var e=n.isUserSignedin(),t=new Promise(function(t,a){n.makeAjaxCalls(i.apiUrl+"/Labs/v2/FetchBenefeciary.json","","GET",e.token,n.getCity()).then(function(i){i.data.isSuccess?(e.beneficiaries=i.data.employeeDetail.beneficiaries,e.allowedRelations=i.data.employeeDetail.allowedRelations,n.setUserObj(e),t(i.data.employeeDetail.beneficiaries,i.data.employeeDetail.validRelations)):a(err)})});return t},R=function(){var e=n.isUserSignedin(),t=new Promise(function(t){_.isEmpty(this.corporateAilments)?n.makeAjaxCalls(i.apiUrl+"/Labs/v1/FetchCorporateAilments/false","","GET",e.token,n.getCity()).then(function(e){e.data&&!_.isEmpty(e.data.ailments)?(this.corporateAilments=e.data.ailments.map(function(e){return e.ailment}),t(this.corporateAilments)):t([])}.bind(this))["catch"](function(e){t([])}):t(this.corporateAilments)}.bind(this));return t},U=function(e,t,a){t||(t=[]);var s={city:n.getCity(),pincode:n.getPincode()};_.extend(s,e);var r=new Promise(function(e,a){var r={},o=n.isUserSignedin();n.makeAjaxCalls(i.apiUrl+"Labs/v1/PackagesListing",s,"POST",o?o.token:"",s.city,!!s.ignoreLoader).then(function(i){i.data.isSuccess?(_.extend(r,_.pick(i.data,"popularCovidTests","popularHealthChecks","popularLabTests","popularCenterVisitHealthChecks","packages")),_.each(r,function(e,a){_.each(e,function(e){e.discount=Math.floor(100-100*e.price/e.priceRange),e.saleActive=!!e.discountInfo.discountPrice,e.selected=!!t.find(function(t){return e.packageId==t.packageId}),e.fromSearch=!1}),r.packages=_.sortBy(r.packages,function(e){return!e.isAvailable}),r.subCategories=i.data.subCategories?i.data.subCategories:[],r.categories=i.data.categories?i.data.categories.filter(function(e){return"Default"!=e}):[]}),e(r)):a()})});return r},j=function(e,t,a){a=a?a:0;var s=new Promise(function(s,r){var o=n.isUserSignedin();n.makeAjaxCalls(i.apiUrl+"Labs/v1/OrdersListing/"+e+"?iteration="+a,"","GET",o?o.token:"",n.getCity(),t).then(function(e){if(e.data.isSuccess&&e.data.totalRecords)s(e.data);else{var t={noMoreRecords:e.data.noMoreRecords,fetchedFromDate:e.data.fetchedFromDate};r(t)}})["catch"](function(e){p.go("app.consumerLabs")})});return s},F=function(e,t){var a=new Promise(function(a,s){var r=n.isUserSignedin();n.makeAjaxCalls(i.apiUrl+t,e,"POST",r?r.token:"",n.getCity()).then(function(e){e.data.isSuccess?a(e.data.isSuccess):s(e.data.isSuccess)})});return a},B=function(e,t,a,i){var s=l.open({animation:!0,backdrop:"none",templateUrl:"labtest/templates/labsOrderActions.html?"+timeStamp,controller:["$scope","$uibModalInstance",function(o,l){o.patients=[],o.cancelRemarksList=[],o.action=a,o.cancelRemarkSel=!1,o.textField={value:"",show:!1},o.selectAll=!0,o.selPatients=[],o.paramObj={orderId:e.orderId,reqIds:[],dcIds:[],isLabVisit:e.isLabVisit};var p={reschedule:[1,2,6],cancel:[1,3,4,6],download:[5,6]},u=["reschedule","cancel"].indexOf(a)>-1?1:5;o.activeScreen=0,o.selectAllChange=function(){_.each(o.patients,function(e){e.disabled||(e.selected=!0)}),o.patientSelection()},o.actionNote="",o.showActionNote=!1,o.removeActionNote=!1,o.patientSelection=function(){var e=o.patients.find(function(e){return e.selected&&e.actionNote});e&&e.actionNote?(o.actionNote=e.actionNote,o.showActionNote=!0,o.removeActionNote=!1):(o.showActionNote=!1,o.removeActionNote=!0),m(function(){o.actionNote=e?e.actionNote:""},700)},o.selectCancelRemarks=function(e,t){"Other"==o.cancelRemarksList[e].remark&&(o.textField.show=t),o.cancelRemarkSel=!!o.cancelRemarksList.find(function(e){return e.selected})},o.nextScreen=function(c,l){l&&s.close();var m=c?p[a].indexOf(c)+1:0;if(m==p[a].length)return void s.close();if(1==u){e.isLabVisit=!_.first(e.patients).orderCurrentStatus.isHomeSampleCollection;var f=0,g=0;o.selectAll=_.isEmpty(t)||e.patients.length==t.length,_.each(e.patients,function(e){f+=e.healthCheckCount,g+=e.labTestCount;var i=e.requests.filter(function(e){return!_.isEmpty(e.actionNotes)}).flatMap(function(e){return e.actionNotes}).find(function(e){return e.action==a});o.patients.push({patientName:e.patientName||e.customerName,patientIcon:J(e.patientId,e.patientGender,e.patientAge),isReschedulable:e.isReschedulable,isCancellable:e.isCancellable,providerName:e.requests[0].providerName,isHomeSampleCollection:e.orderCurrentStatus.isHomeSampleCollection,appointmentDate:new Date(parseInt(e.requests[0].appointmentDate.replace("/Date(","").replace(")/",""),10)),packages:e.requests.filter(function(e){return"reschedule"==a?e.isReschedulable:e.isCancellable}).map(function(e){return{packageId:parseInt(e.packageId)||e.productId,packageName:e.packageName,providerId:e.providerId,contractId:e.contractId,price:e.price,requestId:e.requestId}}),selected:("reschedule"==a?e.isReschedulable:e.isCancellable)&&!!t.find(function(t){return t==e.patientId}),disabled:"reschedule"==a?!e.isReschedulable:!e.isCancellable,actionNote:i?i.note:""}),f&&g?o.testsTxt=f+" Health Packages + "+g+" Lab Tests":f?o.testsTxt=f+" Health Packages":g&&(o.testsTxt=g+" Lab Tests")}),o.patientSelection()}else if(2==u){var h=n.isUserSignedin(),I=[];if(o.calParams={packageIds:[],contractId:o.patients.filter(function(e){return e.selected}).find(function(e){return 9716==e.contractId})?10386:9716,pmEntityId:h.userDetails&&h.userDetails.pmEntityID?h.userDetails.pmEntityID:null,noOfSlots:o.patients.filter(function(e){return e.selected}).length,isHomeVisitCase:_.first(o.patients).isHomeSampleCollection},_.each(o.patients,function(e){e.selected&&(I=_.union(I,e.packages),o.calParams.packageIds=_.uniq(_.union(o.calParams.packageIds,_.pluck(e.packages,"packageId")).map(function(e){return parseInt(e)})),o.paramObj.reqIds=_.union(o.paramObj.reqIds,_.pluck(e.packages,"requestId")),o.paramObj.dcIds=_.uniq(_.union(o.paramObj.dcIds,_.pluck(e.packages,"providerId")).map(function(e){return parseInt(e)})),_.each(o.paramObj.dcIds,function(e){parseInt(e)}),o.selPatients.push(e.patientName))}),o.calParams.contractId=I.find(function(e){return 9716==e.contractId})?9716:10386,_.isEmpty(o.selPatients))return void d({message:"Please select atleast one patient",position:"center",duration:5e3})}else if(3==u){if(_.each(o.patients,function(e){e.selected&&(o.paramObj.reqIds=_.union(o.paramObj.reqIds,_.pluck(e.packages,"requestId")),o.selPatients.push(e.patientName))}),_.isEmpty(o.selPatients))return void d({message:"Please select atleast one patient",position:"center",duration:5e3})}else if(4==u)o.cancelRemarksList=[{remark:"No One Came for Sample Collection",selected:!1},{remark:"Delay in the Order Confirmation",selected:!1},{remark:"Changed the Provider/Time-slot without Consent",selected:!1},{remark:"Booked Appointment with another Service Provider",selected:!1},{remark:"Prices are Too High as compared to Competitors",selected:!1},{remark:"Other",selected:!1}];else if(5==u)_.each(e.patients,function(e){o.patients.push({patientName:e.patientName,patientIcon:J(e.patientId,e.patientGender,e.patientAge),disabled:!e.isReportsAvailable,appointmentDate:new Date(parseInt(e.requests[0].appointmentDate.replace("/Date(","").replace(")/",""),10)),packages:e.requests.map(function(e){return{packageName:e.packageName,disabled:[27,28,42,141,142].includes(e.statusId)||!e.attachments.length,disabledTxt:[27,28,42,141,142].includes(e.statusId)?"Cancelled":e.attachments.length?"":"Reports Processing","class":[27,28,42,141,142].includes(e.statusId)?"error-txt":e.attachments.length?"":".warning-color",selected:!0,urls:e.attachments}})})});else if(6==u){if(["reschedule","cancel"].indexOf(a)==-1){var v=[];return _.each(o.patients,function(e){v=_.union(v,_.flatten(e.packages.filter(function(e){return!e.disabled&&e.selected}).map(function(e){return e.urls})))}),q(v,e.orderId,i),void s.close()}var b="reschedule"==a?{remarks:"Rescheduled by customer",scheduledDate:o.paramObj.prefDateTime,isBulkRequestChange:!0,requestIdsList:o.paramObj.reqIds}:{remarks:"Cancelled by customer",cancellationReason:o.cancelRemarksList.filter(function(e){return e.selected}).map(function(e){return"Other"==e.remark?o.textField.value:e.remark}).join(),requestIds:o.paramObj.reqIds};"reschedule"==a&&o.paramObj.additionalInfo&&(o.paramObj.additionalInfo.slotDistributionForDate&&(b.slotDistributionForDate=o.paramObj.additionalInfo.slotDistributionForDate),o.paramObj.additionalInfo.slotDistributionForInterval&&(b.slotDistributionForInterval=o.paramObj.additionalInfo.slotDistributionForInterval));var y=F(b,"reschedule"==a?"/Reschedule.json":"/Cancel.json");y.then(function(e){if(e){r.$emit("orderStatusChanged");var t="reschedule"==a?"Reschedule Success":"Cancel Success";z(t,{orderId:o.paramObj.orderId}),o.activeScreen=p[a][m]}else d({message:"Something went wrong, please try again",position:"center",duration:5e3})})}6!=u&&(o.activeScreen=p[a][m],u=p[a][m+1])},o.nextScreen(0),o.isMobileView=r.isMobileView,o.closeModal=function(){l.dismiss("cancel")},o["continue"]=function(){o.closeModal()},o.isRescheduled=!1,o.$on("orderRescheduled",function(e,t){o.isRescheduled=!0,c._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Track Order Reschedule",payload:c._Site_Props.__getEventParameters({labsCart:!0,custom:orderRelatedCTPayload})}),initilizeController()})}],size:r.isMobileView?"bottom":"border modal-smd",windowClass:r.isMobileView&&"bottom-sheet"})},q=function(e,t,a){n.multipleFilesDownload(e,t,a)},G=function(e){var a=n.getUserLocation();const i="/assets/icons/location/";if(e)return i+("Home"==e?"home_address.svg":"Office"==e?"work_address.svg":"others_address.svg");if(a&&t.getFlatProperty(a,"primary_location")){var s=t.getFlatProperty(a,"primary_location");return i+("Home"==s?"home_address.svg":"Office"==s?"work_address.svg":"others_address.svg")}},$=function(e,t,a){return 3==this.comparePackages.length&&"add"==t?void d({message:"You can add only 3 packages!!",position:"center",duration:3e3}):void("clear"==t?this.comparePackages.splice(0,this.comparePackages.length):"add"==t?this.comparePackages.push(e):"remove"==t&&this.comparePackages.splice(a,1))},J=function(e,t,a){e=parseInt(e);var i="/assets/icons/Family";if(!e||!a||!t)return i+="/Male/male-18-1.svg";var s=e%4+1;return i+="m"==t.toLowerCase()||"male"==t.toLowerCase()?"/Male/male-":("f"==t.toLowerCase()||"female"==t.toLowerCase(),"/Female/female-"),i+=a<18?"0-":a<35?"18-":a<56?"35-":a>=56?"56-":"18-",i+=s+".svg"},W=function(e,t,a,i){e=parseFloat(e),t=parseFloat(t),a=parseFloat(a),i=parseFloat(i);var s=6371,n=h(a-e),r=h(i-t),o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(h(e))*Math.cos(h(a))*Math.sin(r/2)*Math.sin(r/2),c=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)),l=s*c;return Math.round(100*l)/100},z=function(t,a,i){try{_.isEmpty(i)||(a=_.extend(v(i),a));var s=n.isUserSignedin(),r=n.getUserLocation(),o=[];this&&!_.isEmpty(this.corpBenfits)?(this.corpBenfits.showCorporateBenefitsBanner&&o.push("AHCAvailable"),this.corpBenfits.showCorporateWalletBanner&&o.push("WalletAvailable")):o.push("NA");var l={pincode:"",city:"",flow:"mergeflow",upsellEnabled:!1,latitude:"",longitude:"",primary_location:"",secondary_location:"",placeId:"",srcPage:g(),corpType:"NTPA",isTPA:!1,corpName:"Unknown",userType:"Unknown",pmEntityId:0,corpBenefitAvailable:_.isEmpty(a)||_.isEmpty(a.corpBenefitAvailable)?o.join(","):a.corpBenefitAvailable,utm_source:c.sessionStorage.getItem("utm_source")||null,utm_medium:c.sessionStorage.getItem("utm_medium")||null,utm_campaign:c.sessionStorage.getItem("utm_campaign")||null,walletApplicable:"Unknown"};_.isEmpty(s)||(l.upsellEnabled=s.isUpsellEnabled,l.RxRequired=s.isEnhancedRxFlowEnabled&&N.tests.length>0,_.isEmpty(s.userDetails)||(l.userId=s.userDetails.userId,s.userDetails.pmEntityID&&(l.pmEntityId=s.userDetails.pmEntityID||0,l.userType=s.userDetails.pmEntityID==e.retailUserEntityId?"Retail":"Corporate")),_.isEmpty(s.corpDetails)||_.isEmpty(s.corpDetails.employeeDetail)||(l.isTPA=0!=s.corpDetails.employeeDetail.iwpId&&s.corpDetails.employeeDetail.iwpId!=s.userDetails.pmEntityID,l.corpType=l.isTPA?"TPA":"NTPA",l.corpName=s.corpDetails.employeeDetail.companyName||n.profileInfo.employeeDetail.companyName||l.userType)),_.isEmpty(r)||(l.pincode=r.pincode||"",l.city=r.city||"",l.latitude=r.latitude||"",l.longitude=r.longitude||"",l.primary_location=r.primary_location||"",l.secondary_location=r.secondary_location||"",l.placeId=r.placeId||""),this&&!_.isEmpty(this.walletConfig)&&this.walletConfig.walletLoaded&&(l.walletApplicable=this.walletConfig.walletLoaded?"Yes":"No",l.walletConfig=JSON.stringify(this.walletConfig.walletDetails)),a=_.extend(l,a),c._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:t,dbLog:"consumerlabs",hj:!0,payload:c._Site_Props.__getEventParameters({custom:a,service:a.service||"consumerLabs",google:c._Site_Props.__googleTransform("CONSUMERLABS",t,t)})})}catch(d){console.log(d)}},Y=function(e,a,i){try{if(!e)return;this.standardEventsPayload["mb-s-sessionId"]||(this.standardEventsPayload["mb-s-sessionId"]=t.getMBSessionId());const s=n.isUserSignedin();s&&s.userDetails&&(this.standardEventsPayload.mbuserid=s.userDetails.userId.toString(),s.userDetails.uuid&&(this.standardEventsPayload.mbuuid=s.userDetails.uuid.toString()),this.standardEventsPayload.pmentityid=s.userDetails.pmEntityID.toString());const r=_.extend({},this.standardEventsPayload,a,I(i,s));c._MB_Analytics.__push({name:e.name,schema:e.schema,payload:r})}catch(o){}},K=function(){O=n.isUserSignedin();const e=this.providerParams;if(!O)try{var t=localStorage.getItem("labsCartItems");if(t){var a=JSON.parse(t);if(_.isArray(a)&&!_.isEmpty(a))return void b(a.map(function(e){return e.packageId}),e)}X([],"+",!0)}catch(i){X([],"+",!0),console.log("error while fetching labsCartItems from local storage",i)}},Q=function(t){_.isEmpty(t)&&(t=_.union(N.tests,N.packages)),t=t.filter(function(e){return e.isAvailable}),N.totalPrice=_.pluck(t,"price").reduce(function(e,t){return e+t},0),N.totalSearchCost=_.pluck(N.searchCart,"price").reduce(function(e,t){return e+t},0),N.totalPriceRange=_.pluck(t,"priceRange").reduce(function(e,t){return e+t},0),N.totalDiscount=Math.floor(100-100*N.totalPrice/N.totalPriceRange),N.totalSaleDiscount=0,N.finalSaleAmount=N.totalPrice,_.each(N.packages,function(e){e.saleActive&&(N.finalSaleAmount-=e.price,N.finalSaleAmount+=e.discountInfo.discountPrice,N.totalSaleDiscount+=e.price-e.discountInfo.discountPrice)}),N.isEstimatedPrice=t.some(function(t){return t.currentVisitType!=e.LabVisitType.HOMEVISIT&&!t.isSponsored&&t.price})},X=function(e,t,a,i,s){if(s||(s={}),a){var n=_.uniq(N.patients);N={selectedList:{0:[]},tests:[],packages:[],patients:[],isLabVisit:!1,totalPrice:0,totalPriceRange:0,searchCart:[],totalSearchCost:0,selectedListVTGrouped:{0:{}}},_.each(e,function(e){e.patientId||(e.patientId=0),P(e);var t=S(e);N[t].push(e)}),N.selectedList=_.groupBy(e,"patientId");var o=Object.keys(N.selectedList).map(function(e){return parseInt(e)});_.each(n,function(e){o.includes(e)&&N.patients.push(e)}),_.each(o,function(e){N.patients.includes(e)||N.patients.push(e),N.selectedListVTGrouped[e]=_.groupBy(N.selectedList[e],"currentVisitType")}),N.searchCart=N.patients.length<=1?e:[]}else _.each(e,function(e){e.patientId||(e.patientId=0),P(e),N.selectedList[e.patientId]||(N.selectedList[e.patientId]=[]),N.selectedListVTGrouped[e.patientId]||(N.selectedListVTGrouped[e.patientId]={}),N.selectedListVTGrouped[e.patientId][e.currentVisitType]||(N.selectedListVTGrouped[e.patientId][e.currentVisitType]=[]);var a=S(e);"+"==t?(N.selectedList[e.patientId].push(e),N[a].push(e),N.patients.length<=1&&N.searchCart.push(e),N.selectedListVTGrouped[e.patientId][e.currentVisitType].push(e)):"-"==t&&(N.selectedList[e.patientId]=N.selectedList[e.patientId].filter(function(t){return t.packageId!=e.packageId}),N[a]=N[a].filter(function(t){return t.packageId!=e.packageId}),_.isEmpty(N.selectedList[e.patientId])&&(N.patients=N.patients.filter(function(t){return t.patientId!=e.patientId})),N.patients.length<=1&&(N.searchCart=N.searchCart.filter(function(t){return t.packageId==e.packageId})),N.selectedListVTGrouped[e.patientId][e.currentVisitType]=N.selectedListVTGrouped[e.patientId][e.currentVisitType].filter(function(t){return t.packageId!=e.packageId}))});N.defaultPatId=1==N.patients.length?_.first(N.patients):0,N.empty=_.isEmpty(N.tests)&&_.isEmpty(N.packages),L(s),Q(),C(),r.$broadcast("cartItemsCount",N.tests.length+N.packages.length),m(function(){r.$emit("cartItemsUpdated",{cartItems:e,op:t,refresh:a,params:i,additionalTests:s.additionalTests,allowedVisitTypes:s.allowedVisitTypes})})},Z=function(e,t){var a={city:n.getCity(),pincode:n.getPincode()};_.extend(a,e);var s=n.isUserSignedin();a.getAdditionalTests=a.getAdditionalTests&&s.isTestsSuggestionEnabled;var r=new Promise(function(e,r){n.makeAjaxCalls(i.apiUrl+"Labs/v1/Cart",a,"POST",s.token,n.getCity(),!1,t).then(function(t){t.data.isSuccess?e(t.data):r(err)})["catch"](function(e){r(e)})});return r},ee=function(e,t,i,s,n,r){var o=g();if("+"!=t||n&&n.blockEvents||this.sendEventsV1(a.LABS_ADDTOCART_EVENT,{screenName:(n&&n.screen?n.screen.toLowerCase():"")||o.toLowerCase()},e),s){var c={getAdditionalTests:n&&n.getAdditionalTests,cartVisitType:n&&n.cartVisitType?n.cartVisitType:""};if("+"==t)c.refreshCart=i,c.cartItems=e.map(function(e){return{packageId:e.packageId,patientId:e.patientId||N.defaultPatId,source:e.source||o}});else if("-"==t){c.cartIds=e.map(function(e){return e.cartId});var l=_.flatten(e.filter(function(e){return!_.isEmpty(e.cartIds)}).map(function(e){return e.cartIds}));_.isEmpty(l)||_.extend(c.cartIds,l)}var u=null,m=p.includes("app.consumerCart")||p.includes("app.providerTests");!_.isEmpty(n)&&n.providerId&&m?u={providerId:n.providerId}:this.providerParams.providerSelected&&m&&(u={providerId:this.providerParams.providerId}),_.isEmpty(r)||(u||(u={}),_.extend(u,r)),Z(c,u).then(function(e){N.err=!0,X(e.cartItems,"+",!0,n,e)})["catch"](function(e){e&&e.data&&e.data.errorMessage&&d({message:e.data.errorMessage,position:"center",duration:3e3}),N.err=!1})}else e.forEach(function(e){e.patientId=N.defaultPatId}),X(e,t,i,n)},te=function(){return},ae=function(){return};return{getPackageDetail:H,fetchBenefeciaries:x,updateLabsCart:Z,fetchPackagesListing:U,fetchOrdersListing:j,statusChange:F,orderAction:B,multipleFilesDownload:q,sendEvents:z,sendEventsV1:Y,getGenderIcon:J,locationIcon:G,addItemsToCart:ee,setLabsCart:X,getCartLS:K,saveCartLS:C,removeCartLS:y,getCartDetails:k,calculateTotalPrice:Q,saveUniqCart:T,addLabsStickyHeader:te,remLabsStickyHeader:ae,getDistanceFromLatLonInKm:W,fetchCorporateAilments:R,corpBenfits:{},labsCart:function(){return N},standardEventsPayload:M,dialog:{},providerParams:{},l2cParams:{},walletDetails:{},corporateAilments:[],comparePackages:[],addOrRemoveComparePages:$,redirectToEnabledFlow:E,storeUserConsentStatus:A,getPageConfiguration:D,getCookie:V,setCookie:w}}])})}();